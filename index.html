<!DOCTYPE html>
<html>
    <head>
        <title>Pac Man</title>
    </head>
    <body onkeydown="keyHandler(event)">
        <center>
        <canvas height=700 width=1000 id="duk" style="cursor:none; border: 1px solid black;"></canvas>
        <div id="life"></div>
        <div id="tutorial" style="position: relative; top: -500px;"></div>
        </center>
        
        
        <script>
            var c = document.getElementById("duk");
            var ctx = c.getContext("2d");
            
            var ring;
            var xMan = 500, yMan = 850, xAcc = 0, yAcc = -0.5;
            var key;
            var play = 0, enter = 0, sluta = 0, stop = 0;
            var W, A, S, D;
            var WASD = 1;
            var tutorial = 1, point = 0;
            var color = "black";
            
            // Poäng variabler
            var life = 3;
            
            // Variabler:
            // play: När den är 0 kan man inte styra.
            // enter: Så man bara kan trycka på enter 1 gång.
            // sluta: Så tutorialen kommer upp bara en gång.
            // stop: När den är 0 så stannar bollen.
            // tutorial: Så WASD tutorial 2 bara kommer 1 gång.
            // Point: Är point = 1 så startar poäng tutorialen.
            // WASD: är WASD = 1 och W, A, S och D = 1 startar wall tutorialen.
            
            function pointTimer1() {
                color = "white";
                tutorialPoint(color);
                setTimeout(function() { pointTimer2(); }, 1000);
                
            }
            function pointTimer2() {
                color = "black";
                tutorialPoint(color);
                setTimeout(function() { pointTimer1(); }, 1000);
            }
            
            function PacMan(x, y) {
                ctx.beginPath();
                ctx.arc(x, y, 20, 0, 2*Math.PI);
                ctx.closePath();
                ctx.fill();
            }
            function tutorialPoint(x) {
                ctx.fillStyle = x;
                ctx.beginPath();
                ctx.arc(300, 150, 10, 0, 2*Math.PI);
                ctx.closePath();
                ctx.fill();
            }
            function tutorialWall() {
                ctx.beginPath();
                ctx.fillRect(80, 50, 50, 200);
                ctx.closePath();
            }
            
            function keyHandler(event) {
                key = event.keyCode;
                if(key == 87 && play == 1) { // W
                    xAcc = 0;
                    yAcc = -1;
                    W = 1;
                } else if(key == 83 & play == 1) { // S
                    xAcc = 0;
                    yAcc = 1;
                    S = 1;
                } else if(key == 65 && play == 1) { // A
                    yAcc = 0;
                    xAcc = -1;
                    A = 1;
                } else if(key == 68 && play == 1) { // D
                    yAcc = 0;
                    xAcc = 1;
                    D = 1;
                } else if(key == 13 && enter == 1) { // Enter
                    enter = 0;
                    play = 1;
                    stop = 0;
                    document.getElementById('tutorial').innerHTML = " ";
                }
            }
            // Timer (WASD Tutorial)
            function timer() {
                enter = 1;
                sluta  = 1;
                document.getElementById('tutorial').innerHTML = "Welcome! Control the ball with WASD. Press 'Enter' to continue.";
                
            }
            
            function repaint() {
                ctx.clearRect(0, 0, 1000, 1000);
                yMan = yMan + yAcc;
                xMan = xMan + xAcc;
                PacMan(xMan, yMan);
                // Tutorial saker
                if(tutorial == 0) {
                    tutorialWall();
                } else if(point == 1) {
                    tutorialPoint();
                }
                
                // När man pausar/stänger av.
                if(stop == 1) {
                    yAcc = 0;
                    xAcc = 0;
                }
                // Start
                if(yMan == 600 && xMan == 500) {
                    yAcc = 0;
                    if(sluta == 0) {
                    setTimeout(function() { timer(); }, 800);
                    }
                }
                // WASD Tutorial klar.
                if(W == 1 && S == 1 && A == 1 && D == 1 && WASD == 1) {
                    document.getElementById('life').innerHTML = life;
                    document.getElementById('tutorial').innerHTML = "Good! See that wall? Try go in to it. Press 'Enter' to continue.";
                    stop = 1;
                    enter = 1;
                    play = 0;
                    tutorial = 0;
                    WASD = 0;
                    // När du trycker på Enter så gör den key == 13 på keyHandler.
                }
                
                
                // Krock saker...
                if(xMan < 131 && xMan > 79 && yMan > 50 && yMan < 250 && tutorial == 0) { // Tutorial vägg.
                    if(life == 3) {
                        life = 2;
                    }
                    document.getElementById('life').innerHTML = life;
                    document.getElementById('tutorial').innerHTML = "If you hit a wall you loose. You have 3 lifes. If you die 3 times it's game over. Press 'Enter' to continue.";
                    play = 0;
                    stop = 1;
                    if(key == 13) {
                        document.getElementById('tutorial').innerHTML = "";
                        yMan = 600;
                        xMan = 500;
                        point = 1;
                        tutorial = 1;
                        pointTimer1();
                    }
                } 
            }
        window.setInterval(repaint, 1);

        </script>
    </body>
</html>