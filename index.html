<!DOCTYPE html>
<html>
    <head>
        <title>Pac Man</title>
    </head>
    <body onkeydown="keyHandler(event)">
        <center>
        <canvas height=700 width=1000 id="duk" style="cursor:none; border: 1px solid black;"></canvas>
        <div id="life"></div>
        <div id="tutorial" style="position: relative; top: -500px;"></div>
        <div id="points" style="position: relative; top: -60px;"></div>
        </center>
        
        
        <script>
            var c = document.getElementById("duk");
            var ctx = c.getContext("2d");
            var tutorial;
            var xMan = 500, yMan = 850, xAcc = 0, yAcc = -2;
            var key;
            function keyHandler(event) {
                key = event.keyCode;
                if(key == 87 && play == 1) { // W
                    xAcc = 0;
                    yAcc = -4;
                    W = 1;
                } else if(key == 83 & play == 1) { // S
                    xAcc = 0;
                    yAcc = 4;
                    S = 1;
                } else if(key == 65 && play == 1) { // A
                    yAcc = 0;
                    xAcc = -4;
                    A = 1;
                } else if(key == 68 && play == 1) { // D
                    yAcc = 0;
                    xAcc = 4;
                    D = 1;
                } else if(key == 13 && enter == 1) { // Enter
                    enter = 0;
                    play = 1;
                    stop = 0;
                    document.getElementById('tutorial').innerHTML = " ";
                }
            }
            
            tutorial = prompt("Vill du köra tutorialen= Y/N?")
            if(tutorial == "Y" || tutorial == "y") {
                tutorial = 1;
            } else if(tutorial == "N" || tutorial == "n") {
                tutorial = 0;
            } else {
                alert("Skriv 'Y' eller 'N'.");
            }
            // Tutorial
            if(tutorial == 1) {
                var play = 0, enter = 0, sluta = 0, stop = 0;
                var W, A, S, D;
                var WASD = 1;
                var tutorial = 1, point, pointtut = 2;
                var color = "black";
                var repeat = 1;
                var timervar = 0;

                // Poäng variabler
                var life = 3;
                var GamePoint = 0;
                var pointover = 1;

                // Variabler:
                // play: När den är 0 kan man inte styra.
                // enter: Så man bara kan trycka på enter 1 gång.
                // sluta: Så tutorialen kommer upp bara en gång.
                // stop: När den är 1 så stannar bollen.
                // tutorial: Så WASD tutorial 2 bara kommer 1 gång.
                // Point: Är point = 1 så börjar bollen blinka
                // WASD: är WASD = 1 och W, A, S och D = 1 startar wall tutorialen.
                // Pointtut: När denna var = 1 så börjar point tutorialen
                // Pointover: Är pointover 0 så stängs en poäng sak av.
                // Repeat: När den är 1 så körs tutrialen.

                function tutorialPoint(x) {
                    ctx.fillStyle = x;
                    ctx.beginPath();
                    ctx.arc(300, 150, 10, 0, 2*Math.PI);
                    ctx.fill();
                    ctx.closePath();
                }

                function PacMan(x, y) {
                    ctx.beginPath();
                    ctx.arc(x, y, 20, 0, 2*Math.PI);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function tutorialWall() {
                    ctx.beginPath();
                    ctx.fillRect(80, 50, 50, 200);
                    ctx.closePath();
                }

                // Timer (WASD Tutorial)
                function timer() {
                    enter = 1;
                    sluta  = 1;
                    document.getElementById('tutorial').innerHTML = "Welcome! Control the ball with WASD. Press 'Enter' to continue.";

                }

                function repaint() {
                    ctx.clearRect(0, 0, 1000, 1000);

                    // Detta gör så att poängen blinkar.
                    if(point == 1) {
                        timervar = timervar + 20;
                        if(timervar < 1000) {
                            color = "black";
                            tutorialPoint(color);
                        } else if(timervar > 1000 && timervar < 1500) {
                            color = "gold";
                            tutorialPoint(color);
                        } else if(timervar > 1500) {
                            timervar = 0;
                        }
                    }


                    yMan = yMan + yAcc;
                    xMan = xMan + xAcc;
                    PacMan(xMan, yMan);
                    // Tutorial saker
                    if(tutorial == 0) {
                        tutorialWall();
                    }

                    // När man pausar/stänger av.
                    if(stop == 1) {
                        yAcc = 0;
                        xAcc = 0;
                    }
                    // Start
                    if(yMan == 600 && xMan == 500) {
                        yAcc = 0;
                        if(sluta == 0) {
                            setTimeout(function() { timer(); }, 800);
                        }
                    }
                    // WASD Tutorial klar.
                    if(W == 1 && S == 1 && A == 1 && D == 1 && WASD == 1) {
                        document.getElementById('life').innerHTML = "Lifes: " + life;
                        document.getElementById('tutorial').innerHTML = "Good! See that wall? Try go in to it. Press 'Enter' to continue.";
                        stop = 1;
                        enter = 1;
                        play = 0;
                        tutorial = 0;
                        WASD = 0;
                        // När du trycker på Enter så gör den key == 13 på keyHandler.
                    }
                    // Point tutorial
                    if(pointtut == 1) {
                        document.getElementById('tutorial').innerHTML = "Collect points by runnning over the flashing dots. Press 'Enter' to continue.";
                        play = 0;
                        stop = 1;
                        pointtut = 0;
                    }
                    if(key == 13 && pointtut == 0) {
                        play = 1;
                        stop = 0;
                        pointtut = 0;
                        document.getElementById('tutorial').innerHTML = "";
                    }


                    // Krock saker...
                    if(xMan < 131 && xMan > 79 && yMan > 50 && yMan < 250 && tutorial == 0) { // Tutorial vägg.
                        if(life == 3) {
                            life = 2;
                        }
                        document.getElementById('life').innerHTML = "Lifes: " + life;
                        document.getElementById('tutorial').innerHTML = "If you hit a wall you loose. You have 3 lifes. If you die 3 times it's game over. Press 'Enter' to continue.";
                        play = 0;
                        stop = 1;
                        if(key == 13) {
                            document.getElementById('tutorial').innerHTML = "";
                            yMan = 600;
                            xMan = 500;
                            point = 1;
                            tutorial = 1;
                            pointtut = 1;
                        }
                    }
                    // Poäng saker..
                    if(xMan > 270 && xMan < 330 && yMan > 145 && yMan < 155 && pointover == 1) {
                        GamePoint++;
                        point = 0;
                        play = 0;
                        stop = 1;
                        document.getElementById('points').innerHTML = "Point: " + point;
                        document.getElementById('tutorial').innerHTML = "Great! You are now done with the tutorial. Press 'Enter' to continue with the game."
                        if(key == 13) {
                            repeat = 0;
                            pointover = 0;
                        }
                    }
                }
                window.setInterval(repaint, 20);
                
                
                
                
                 
                // Spelet
            } else if(tutorial == 0) {
                // Variabler
                var play = 1;
                var ywall1 = 0;
                var level = 1;
                var timervar = 0;
                var color;
                
                function PacMan(x, y) {
                    ctx.beginPath();
                    ctx.arc(x, y, 20, 0, 2*Math.PI);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function wall1(y) {
                    ctx.beginPath();
                    ctx.rect(530, 1000, 30, y);
                    ctx.fill();
                    ctx.closePath();
                }
                function wall2(y) {
                    ctx.beginPath();
                    ctx.rect(440, 1000, 30, y);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function level2wall1() {
                    ctx.beginPath();
                    ctx.rect(530, 1000, 30, -600);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function level2wall2() {
                    ctx.beginPath();
                    ctx.rect(530, 0, 30, 300);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function level2wall3() {
                    ctx.beginPath();
                    ctx.rect(440, 1000, 30, -600);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function level2wall4() {
                    ctx.beginPath();
                    ctx.rect(440, 0, 30, 300);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.closePath();
                }
                function point(x, y, z) {
                    ctx.fillStyle = z;
                    ctx.beginPath();
                    ctx.arc(x, y, 10, 0, 2*Math.PI);
                    ctx.fill();
                    ctx.closePath();
                }
                
                function playpaint() {
                    ctx.clearRect(0, 0, 1000, 1000);
                    
                    xMan = xMan + xAcc;
                    yMan = yMan + yAcc;
                    PacMan(xMan, yMan);
                    
                    if(level == 1) {
                    ywall1 = ywall1 - 5;
                    wall1(ywall1);
                    wall2(ywall1);
                    
                    // När den ska stanna
                    if(play == 0) {
                        xAcc = 0;
                        yAcc = 0;
                    }
                    
                    // När den kommer upp
                    if(xMan == 500 && yMan == 600) {
                        yAcc = 0;
                    }
                    
                    // Krock skit
                    if(xMan > 420 && xMan < 480) {
                        play = 0;
                    } else if(xMan > 510 && xMan < 570) {
                        play = 0;
                    } else if(yMan == -20) { // Level 1 done
                        yMan = 800;
                        level = 2;
                    }
                    
                } else if(level == 2) {
                    timervar = timervar + 20;
                    if(timervar < 1000) {
                        color = "black";
                        point(300, 300, color);
                    } else if(timervar > 1000 && timervar < 1500) {
                        color = "gold";
                        point(300, 300, color);
                    } else if(timervar > 1500) {
                        timervar = 0;
                    }
                    
                    level2wall1();
                    level2wall2();
                    level2wall3();
                    level2wall4();
                    
                    
                    
                    if(yMan == 800) {
                        level = 1;
                        yMan = -20;
                    }
                }
                }
                
                window.setInterval(playpaint, 20) 
            }
        </script>
    </body>
</html>